<!DOCTYPE html>
<!--
TODO
nicer hands
add numeric time written
convert to widget
publish on the store; installable PWA
consistent dark color to system color
-->
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="version" content="3.0" />
  <link rel="manifest" href="manifest.json" />
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js");
    }
  </script>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Analog Clock</title>
  <meta name="theme-color" content="#121212" />

  <style>
    :root {
      /* Clock sizing */
      --clock-size: 80vmin;

      /* Theme colors*/
      --background-body: #000;
      --forecolor: #ccc;
      --objects-border-color: black;
      --shadow-color: #0005;
      --dial-color-top: brown;
      --dial-color-bottom: darkblue;
      --hour-hand-color: #f0a500;
      --minute-hand-color: #bfb;
      --second-hand-color: #e63946;
      --center-dot-color: #39b;
    }

    body {
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 0;
      height: 100vh;
      background: var(--background-body);
      color: var(--forecolor);
      font-family: Arial, sans-serif;
    }

    .physical_obj {
      position: absolute;
      transform: translate(-50%, -50%);
      border: 0.1vmin solid var(--objects-border-color);
      box-shadow: 2px 2px 4px var(--shadow-color);
    }

    .analog_clock {
      position: relative;
      width: var(--clock-size);
      height: var(--clock-size);
      border: 0.5vmin solid var(--forecolor);
      border-radius: 50%;
      background: linear-gradient(
        to bottom,
        var(--dial-color-top) 0%,
        var(--dial-color-top) 50%,
        var(--dial-color-bottom) 50%,
        var(--dial-color-bottom) 100%
      );
      box-shadow: inset 0 0 10px var(--shadow-color);
    }

    .dial {
      position: absolute;
      width: 100%;
      height: 100%;
    }

    .tick {
      position: absolute;
      left: 50%;
      top: 50%;
      transform-origin: 50% 0%;
      border-radius: 0.2vmin;
      background: var(--forecolor);
    }

    .tick.hour {
      height: 14vmin;
      width: 0.4vmin;
    }

    .tick.minute {
      height: 2vmin;
      width: 0.4vmin;
    }

    .dial_number {
      position: absolute;
      width: 100%;
      height: 100%;
      color: var(--forecolor);
    }

    .dial_number span {
      position: absolute;
      width: 4vmin;
      height: 4vmin;
      transform: translate(-50%, -50%);
      text-align: center;
      line-height: 4vmin;
      text-shadow: 2px 2px 4px var(--shadow-color);
    }

    .dial_number.hour {
      font-size: 5vmin;
      font-weight: bold;
    }
    .dial_number.minute {
      font-size: 3vmin;
      font-weight: normal;
    }

    .physical_obj.hand {
      transform-origin: bottom center;
      bottom: 50%;
      left: 50%;
      border-radius: 2vmin;
      z-index: 3;
    }

    .physical_obj.hand.hour {
      z-index: 5;
      height: 33vmin;
      width: 1.5vmin;
      background: var(--hour-hand-color);
    }

    .physical_obj.hand.minute {
      z-index: 4;
      height: 44vmin;
      width: 1.2vmin;
      background: var(--minute-hand-color);
    }

    .physical_obj.hand.second {
      z-index: 6;
      height: 47vmin;
      width: 0.5vmin;
      background: var(--second-hand-color);
    }

    .sun {
      position: absolute;
      top: 20%;
      left: 50%;
      transform: translateX(-50%);
      z-index: 7;
      width: 7vmin;
      height: 7vmin;
      border-radius: 50%;
      background: var(--hour-hand-color);
      opacity: 0.6;
      box-shadow: 0 0 8px var(--hour-hand-color);
    }

    .center-dot {
      top: 50%;
      left: 50%;
      z-index: 10;
      border-radius: 50%;
      width: 3.5vmin;
      height: 3.5vmin;
      background: var(--center-dot-color);
    }
  </style>
</head>

<body>
  <div class="analog_clock" 
       data-new-type="true" 
       data-classic24-hour-numbers="true" 
       data-only-even-numbers="false" 
       data-classic-minute-positioning="true"
       data-rotation-dir="natural">
    <div class="dial"></div>
    <div alt="hour_numbers" class="dial_number hour"></div>
    <div alt="minute_numbers" class="dial_number minute"></div>
    <div alt="hour_hand" class="physical_obj hand hour">
      <div class="sun"></div>
    </div>
    <div alt="minute_hand" class="physical_obj hand minute"></div>
    <div alt="second_hand" class="physical_obj hand second"></div>
    <div class="physical_obj center-dot"></div>
  </div>

  <script>
    // TODO
    // nicer hands
    // add numeric time written
    // convert to widget
    // publish on the store; installable PWA
    // consistent dark color to system color

    function motorRotate(clock) {
      const hour_hand = clock.querySelector('.hand.hour');
      const minute_hand = clock.querySelector('.hand.minute');
      const second_hand = clock.querySelector('.hand.second');

      const timezone = clock.dataset.timezone || Intl.DateTimeFormat().resolvedOptions().timeZone;
      const now = new Date(new Date().toLocaleString("en-US", {timeZone: timezone}));
      const newType = clock.dataset.newType === "true";
      const classicMinutePositioning = clock.dataset.classicMinutePositioning === "true";

      let hour = now.getHours();
      let minute = now.getMinutes();
      let second = now.getSeconds();

      if (newType) {
        hour = (hour - 6 + 24) % 24;
      }

      let hourDeg = (hour + minute / 60) * 15;
      let minuteDeg = minute * 6;
      let secondDeg = second * 6;

      if (newType) {
        hourDeg = -hourDeg + 90;
        minuteDeg = -minuteDeg - 90;
        secondDeg = -secondDeg - 90;
      }

      if (classicMinutePositioning) {
        minuteDeg += 90;
        secondDeg += 90;
      }

      hour_hand.style.transform = `translateX(-50%) rotate(${hourDeg}deg)`;
      minute_hand.style.transform = `translateX(-50%) rotate(${minuteDeg}deg)`;
      second_hand.style.transform = `translateX(-50%) rotate(${secondDeg}deg)`;
    }

    function staticPartsCreate(clock) {
      const dial = clock.querySelector('.dial');
      const hour_numbers = clock.querySelector('.dial_number.hour');
      const minute_numbers = clock.querySelector('.dial_number.minute');
      const onlyEvenNumbers = clock.dataset.onlyEvenNumbers === "true";
      const newType = clock.dataset.newType === "true";
      const classic24HourNumbers = clock.dataset.classic24HourNumbers === "true";
      const classicMinutePositioning = clock.dataset.classicMinutePositioning === "true";

      //generatedial
      dial.innerHTML = '';
      for (let i = 0; i < 24; i++) {
        const tick = document.createElement('div');
        tick.className = 'tick hour';
        tick.style.transform = `rotate(${i * 15}deg) translateY(-40.5vmin)`;
        dial.appendChild(tick);
      }
      for (let i = 0; i < 60; i++) {
        const tick = document.createElement('div');
        tick.className = 'tick minute';
        tick.style.transform = `rotate(${i * 6}deg) translateY(-42vmin)`;
        dial.appendChild(tick);
      }

      //generateHourNumbers
      hour_numbers.innerHTML = '';
      for (let i = 0; i < 24; i++) {
        if (!onlyEvenNumbers || i % 2 === 0) {
          const span = document.createElement('span');
          const angle = newType ? -(i - 6 + 0.5) * 15 : i * 15;

          let hourNumber;
          if (classic24HourNumbers) {
            hourNumber = ((i + 6 - 1) % 12) + 1;
          } else {
            hourNumber = i % 24;
          }

          const radius = 44;
          const rad = (angle - 90) * Math.PI / 180;
          const x = 50 + radius * Math.cos(rad);
          const y = 50 + radius * Math.sin(rad);
          span.style.left = `${x}%`;
          span.style.top = `${y}%`;
          span.textContent = hourNumber;
          hour_numbers.appendChild(span);
        }
      }

      //generateMinuteNumbers
      minute_numbers.innerHTML = '';
      const radius = 59;
      for (let i = 0; i < 60; i += 5) {
        const span = document.createElement('span');
        let angle = i * 6;
        if (classicMinutePositioning) angle -= 90;
        const rad = (180 - angle) * Math.PI / 180;
        const x = 50 + radius * Math.cos(rad);
        const y = 50 + radius * Math.sin(rad);
        span.style.left = `${x}%`;
        span.style.top = `${y}%`;
        span.textContent = i === 0 ? '0' : i.toString();
        minute_numbers.appendChild(span);
      }
    }

    window.addEventListener('resize', staticPartsCreate);

    // Initialize
    // Initialize all clocks
    document.querySelectorAll('.analog_clock').forEach(clock => {
      staticPartsCreate(clock);
      motorRotate(clock);
    });

    // Update all clocks every second
    setInterval(() => {
      document.querySelectorAll('.analog_clock').forEach(motorRotate);
    }, 1000);

    // Handle resize
    window.addEventListener('resize', () => {
      document.querySelectorAll('.analog_clock').forEach(staticPartsCreate);
    });
  </script>
</body>
</html>
